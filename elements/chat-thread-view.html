<!--
Copyright (c) 2015-16 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../components/polymer/polymer.html">
<link rel="import" href="../components/paper-input/paper-input.html">
<link rel="import" href="../components/paper-item/paper-item.html">
<link rel="import" href="../components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../components/paper-item/paper-item-body.html">

<link rel="import" href="../elements/input-header.html">

<link rel="import" href="../data/chat-view-store.html">

<dom-module id="chat-thread-view">

  <template>

    <style>
      :host {
        @apply(--layout-vertical);
      }
      .list {
        @apply(--layout-flex);
        overflow: auto;
      }
      paper-input {
        padding: 10px;
      }
    </style>

    <chat-view-store id="store" selected-thread="{{thread}}" user="{{user}}"></chat-view-store>

    <input-header label="[[thread.title]]" on-input="_updateTitle"></input-header>

    <div class="list">
      <template is="dom-repeat" items="[[thread.messages]]">
        <paper-item>
          <paper-item-body two-line>
            <div>[[item.user]]</div>
            <div secondary>[[item.text]]</div>
          </paper-item-body>
        </paper-item>
      </template>
    </div>

    <paper-input label="New Message:" on-keyup="_handleInput"></paper-input>

  </template>

  <script>
    Polymer({

      is: 'chat-thread-view',

      properties: {

        thread: Object,

        user: Object

      },

      _handleInput: function(e) {
        if (e.keyCode == 13) {
          this.$.store.post({
              threadId: this.thread.id,
              user: this.user.name,
              text: e.target.value
          });
          e.target.value = '';
        }
      },

      _updateTitle: function (e) {
          this.$.store.setThreadTitle({
              threadId: this.thread.id,
              title: e.target.value
          });
      }

    });
  </script>

</dom-module>

